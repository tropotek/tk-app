#!/bin/bash

# get latest code from repo
git pull
git config --global --add safe.directory /app

# install composer dependencies
composer install

# generate APP_KEY if none exists
if ! grep -q '^APP_KEY=base64:' .env; then
  echo "Generating APP_KEY..."
  (
    php artisan key:generate --force
  )
fi

# copy assets to public folder
cp -f vendor/twbs/bootstrap/dist/css/bootstrap.min.css* public/css/
cp -f vendor/twbs/bootstrap/dist/js/bootstrap.bundle.min.js* public/js/
cp -f vendor/htmx/htmx/htmx.min.js public/js/
cp -f vendor/jquery/jquery/jquery-3.7.1.min.js public/js/jquery.min.js

# database migrations
touch database/database.sqlite
php artisan migrate:fresh --seed
#php artisan migrate    # may cause errors if the key has been re-generated
